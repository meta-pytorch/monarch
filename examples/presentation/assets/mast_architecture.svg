<svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Define styles -->
    <style>
      .host-group { fill: #f5f5f5; stroke: #999; stroke-width: 2; }
      .cpu-host { fill: #9E9E9E; stroke: #616161; stroke-width: 2; }
      .h100-host { fill: #4CAF50; stroke: #2E7D32; stroke-width: 2; }
      .replay-actor { fill: #FF5722; stroke: #D84315; stroke-width: 2; }
      .learner-actor { fill: #2196F3; stroke: #1565C0; stroke-width: 2; }
      .generator-actor { fill: #9C27B0; stroke: #6A1B9A; stroke-width: 2; }
      .scorer-actor { fill: #FF9800; stroke: #E65100; stroke-width: 2; }
      .queue-actor { fill: #00BCD4; stroke: #006064; stroke-width: 2; }
      .reference-arrow { stroke: #E91E63; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
      .mesh-connection { stroke: #666; stroke-width: 1; opacity: 0.4; stroke-dasharray: 2,2; }
      .node-text { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: white; font-weight: bold; }
      .title-text { font-family: Arial, sans-serif; font-size: 16px; text-anchor: middle; fill: #333; font-weight: bold; }
      .host-label { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; fill: #333; font-weight: bold; }
      .scale-text { font-family: Arial, sans-serif; font-size: 9px; text-anchor: middle; fill: #666; }
      .code-text { font-family: 'Courier New', monospace; font-size: 9px; text-anchor: start; fill: #333; }
    </style>

    <!-- Arrow marker for references -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#E91E63"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="500" y="25" class="title-text">MAST Job Architecture - Distributed RL Training</text>

  <!-- Action descriptions -->
  <rect x="50" y="520" width="900" height="100" fill="#f9f9f9" stroke="#ddd" stroke-width="1" rx="10"/>
  <text x="500" y="545" class="title-text" style="font-size: 14px;">Actor Actions</text>
  <text x="70" y="565" class="code-text" style="font-size: 11px;">• Learners sample training data from ReplayBuffer via sample_from()</text>
  <text x="70" y="580" class="code-text" style="font-size: 11px;">• Generators submit text completions to TrajectoryQueue via put()</text>
  <text x="70" y="595" class="code-text" style="font-size: 11px;">• Scorers get trajectories from TrajectoryQueue via get(), score them, then put() results in ReplayBuffer</text>

  <!-- Host Groups -->
  <!-- Replay Buffer Host Group -->
  <rect x="50" y="60" width="200" height="200" class="host-group" rx="10"/>
  <text x="150" y="80" class="host-label">Replay Buffer Hosts</text>
  <text x="150" y="95" class="scale-text">1 x CPU machine</text>

  <!-- CPU Host -->
  <circle cx="150" cy="140" r="25" class="cpu-host"/>
  <text x="150" y="145" class="node-text">CPU Host</text>

  <!-- Replay Buffer Actor -->
  <rect x="90" y="175" width="60" height="30" class="replay-actor" rx="5"/>
  <text x="120" y="195" class="node-text">ReplayBuffer</text>

  <!-- Trajectory Queue Actor -->
  <rect x="155" y="175" width="50" height="30" class="queue-actor" rx="5"/>
  <text x="180" y="195" class="node-text">TrajQueue</text>

  <!-- Learner Host Group -->
  <rect x="300" y="60" width="250" height="200" class="host-group" rx="10"/>
  <text x="425" y="80" class="host-label">Learner Hosts</text>
  <text x="425" y="95" class="scale-text">64 x H100 machines, 8 GPUs each = 512 learners</text>

  <!-- Sample H100 Hosts for Learners -->
  <circle cx="350" cy="130" r="20" class="h100-host"/>
  <text x="350" y="135" class="node-text">H100-1</text>
  <circle cx="425" cy="130" r="20" class="h100-host"/>
  <text x="425" y="135" class="node-text">H100-2</text>
  <circle cx="500" cy="130" r="20" class="h100-host"/>
  <text x="500" y="135" class="node-text">H100-64</text>

  <!-- Learner Actors -->
  <circle cx="330" cy="180" r="12" class="learner-actor"/>
  <text x="330" y="185" class="node-text">L1</text>
  <circle cx="350" cy="180" r="12" class="learner-actor"/>
  <text x="350" y="185" class="node-text">L2</text>
  <circle cx="370" cy="180" r="12" class="learner-actor"/>
  <text x="370" y="185" class="node-text">L8</text>

  <circle cx="405" cy="180" r="12" class="learner-actor"/>
  <text x="405" y="185" class="node-text">L9</text>
  <circle cx="425" cy="180" r="12" class="learner-actor"/>
  <text x="425" y="185" class="node-text">L10</text>
  <circle cx="445" cy="180" r="12" class="learner-actor"/>
  <text x="445" y="185" class="node-text">L16</text>

  <circle cx="480" cy="180" r="12" class="learner-actor"/>
  <text x="480" y="185" class="node-text">L505</text>
  <circle cx="500" cy="180" r="12" class="learner-actor"/>
  <text x="500" y="185" class="node-text">L506</text>
  <circle cx="520" cy="180" r="12" class="learner-actor"/>
  <text x="520" y="185" class="node-text">L512</text>

  <!-- Mesh connections between learners -->
  <line x1="350" y1="180" x2="425" y2="180" class="mesh-connection"/>
  <line x1="425" y1="180" x2="500" y2="180" class="mesh-connection"/>
  <text x="425" y="210" class="scale-text">Learner Mesh Network</text>

  <!-- Generator Host Group -->
  <rect x="600" y="60" width="250" height="200" class="host-group" rx="10"/>
  <text x="725" y="80" class="host-label">Generator Hosts</text>
  <text x="725" y="95" class="scale-text">64 x H100 machines, 8 GPUs each = 512 generators</text>

  <!-- Sample H100 Hosts for Generators -->
  <circle cx="650" cy="130" r="20" class="h100-host"/>
  <text x="650" y="135" class="node-text">H100-65</text>
  <circle cx="725" cy="130" r="20" class="h100-host"/>
  <text x="725" y="135" class="node-text">H100-66</text>
  <circle cx="800" cy="130" r="20" class="h100-host"/>
  <text x="800" y="135" class="node-text">H100-128</text>

  <!-- Generator Actors -->
  <circle cx="630" cy="180" r="12" class="generator-actor"/>
  <text x="630" y="185" class="node-text">G1</text>
  <circle cx="650" cy="180" r="12" class="generator-actor"/>
  <text x="650" y="185" class="node-text">G2</text>
  <circle cx="670" cy="180" r="12" class="generator-actor"/>
  <text x="670" y="185" class="node-text">G8</text>

  <circle cx="705" cy="180" r="12" class="generator-actor"/>
  <text x="705" y="185" class="node-text">G9</text>
  <circle cx="725" cy="180" r="12" class="generator-actor"/>
  <text x="725" y="185" class="node-text">G10</text>
  <circle cx="745" cy="180" r="12" class="generator-actor"/>
  <text x="745" y="185" class="node-text">G16</text>

  <circle cx="780" cy="180" r="12" class="generator-actor"/>
  <text x="780" y="185" class="node-text">G505</text>
  <circle cx="800" cy="180" r="12" class="generator-actor"/>
  <text x="800" y="185" class="node-text">G506</text>
  <circle cx="820" cy="180" r="12" class="generator-actor"/>
  <text x="820" y="185" class="node-text">G512</text>

  <!-- Scorer Host Group -->
  <rect x="300" y="300" width="200" height="200" class="host-group" rx="10"/>
  <text x="400" y="320" class="host-label">Scorer Hosts</text>
  <text x="400" y="335" class="scale-text">2 x H100 machines, 8 GPUs each = 16 scorers</text>

  <!-- H100 Hosts for Scorers -->
  <circle cx="350" cy="370" r="20" class="h100-host"/>
  <text x="350" y="375" class="node-text">H100-129</text>
  <circle cx="450" cy="370" r="20" class="h100-host"/>
  <text x="450" y="375" class="node-text">H100-130</text>

  <!-- Scorer Actors -->
  <circle cx="330" cy="420" r="12" class="scorer-actor"/>
  <text x="330" y="425" class="node-text">S1</text>
  <circle cx="350" cy="420" r="12" class="scorer-actor"/>
  <text x="350" y="425" class="node-text">S2</text>
  <circle cx="370" cy="420" r="12" class="scorer-actor"/>
  <text x="370" y="425" class="node-text">S8</text>

  <circle cx="430" cy="420" r="12" class="scorer-actor"/>
  <text x="430" y="425" class="node-text">S9</text>
  <circle cx="450" cy="420" r="12" class="scorer-actor"/>
  <text x="450" y="425" class="node-text">S10</text>
  <circle cx="470" cy="420" r="12" class="scorer-actor"/>
  <text x="470" y="425" class="node-text">S16</text>

  <!-- Reference Arrows with Action Labels -->
  <!-- Learners -> ReplayBuffer: sample_from() -->
  <path d="M 425,180 Q 300,120 135,190" class="reference-arrow"/>
  <text x="280" y="140" class="node-text" style="fill: #E91E63; font-size: 11px; text-anchor: middle;">sample_from()</text>

  <!-- Generators -> TrajectoryQueue: put() -->
  <path d="M 725,180 Q 550,120 195,190" class="reference-arrow"/>
  <text x="580" y="140" class="node-text" style="fill: #E91E63; font-size: 11px; text-anchor: middle;">put()</text>

  <!-- Scorers -> TrajectoryQueue: get() -->
  <path d="M 450,420 Q 350,350 180,205" class="reference-arrow"/>
  <text x="320" y="320" class="node-text" style="fill: #E91E63; font-size: 11px; text-anchor: middle;">get()</text>

  <!-- Scorers -> ReplayBuffer: put() -->
  <path d="M 350,420 Q 250,320 120,205" class="reference-arrow"/>
  <text x="230" y="280" class="node-text" style="fill: #E91E63; font-size: 11px; text-anchor: middle;">put()</text>


  <!-- Legend -->
  <rect x="880" y="60" width="110" height="200" fill="#f9f9f9" stroke="#ccc" stroke-width="1" rx="5"/>
  <text x="935" y="80" class="host-label" style="font-size: 11px;">Legend</text>

  <circle cx="900" cy="100" r="8" class="cpu-host"/>
  <text x="915" y="105" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">CPU Host</text>

  <circle cx="900" cy="120" r="8" class="h100-host"/>
  <text x="915" y="125" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">H100 Host</text>

  <circle cx="900" cy="140" r="8" class="replay-actor"/>
  <text x="915" y="145" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">ReplayBuffer</text>

  <circle cx="900" cy="160" r="8" class="queue-actor"/>
  <text x="915" y="165" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">TrajQueue</text>

  <circle cx="900" cy="180" r="8" class="learner-actor"/>
  <text x="915" y="185" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">Learner</text>

  <circle cx="900" cy="200" r="8" class="generator-actor"/>
  <text x="915" y="205" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">Generator</text>

  <circle cx="900" cy="220" r="8" class="scorer-actor"/>
  <text x="915" y="225" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">Scorer</text>

  <line x1="900" y1="240" x2="920" y2="240" class="reference-arrow"/>
  <text x="925" y="245" class="node-text" style="fill: #333; font-size: 9px; text-anchor: start;">Reference</text>
</svg>
