<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Define styles -->
    <style>
      .client { fill: #4CAF50; stroke: #2E7D32; stroke-width: 2; }
      .host-tier1 { fill: #2196F3; stroke: #1565C0; stroke-width: 2; }
      .host-tier2 { fill: #FF9800; stroke: #E65100; stroke-width: 2; }
      .connection { stroke: #666; stroke-width: 1; opacity: 0.3; }
      .message { fill: #E91E63; stroke: #AD1457; stroke-width: 1; }
      .node-text { font-family: Arial, sans-serif; font-size: 10px; text-anchor: middle; fill: white; font-weight: bold; }
      .title-text { font-family: Arial, sans-serif; font-size: 16px; text-anchor: middle; fill: #333; font-weight: bold; }
    </style>
  </defs>

  <!-- Title -->
  <text x="400" y="25" class="title-text">learner.step.call() message propagation</text>

  <!-- Connection lines from client to tier 1 -->
  <line x1="400" y1="80" x2="200" y2="200" class="connection"/>
  <line x1="400" y1="80" x2="350" y2="200" class="connection"/>
  <line x1="400" y1="80" x2="450" y2="200" class="connection"/>
  <line x1="400" y1="80" x2="600" y2="200" class="connection"/>

  <!-- Connection lines from tier 1 to tier 2 -->
  <!-- From host 1 -->
  <line x1="200" y1="220" x2="80" y2="360" class="connection"/>
  <line x1="200" y1="220" x2="140" y2="360" class="connection"/>
  <line x1="200" y1="220" x2="200" y2="360" class="connection"/>
  <line x1="200" y1="220" x2="260" y2="360" class="connection"/>

  <!-- From host 2 -->
  <line x1="350" y1="220" x2="290" y2="360" class="connection"/>
  <line x1="350" y1="220" x2="330" y2="360" class="connection"/>
  <line x1="350" y1="220" x2="370" y2="360" class="connection"/>
  <line x1="350" y1="220" x2="410" y2="360" class="connection"/>

  <!-- From host 3 -->
  <line x1="450" y1="220" x2="440" y2="360" class="connection"/>
  <line x1="450" y1="220" x2="480" y2="360" class="connection"/>
  <line x1="450" y1="220" x2="520" y2="360" class="connection"/>
  <line x1="450" y1="220" x2="560" y2="360" class="connection"/>

  <!-- From host 4 -->
  <line x1="600" y1="220" x2="590" y2="360" class="connection"/>
  <line x1="600" y1="220" x2="630" y2="360" class="connection"/>
  <line x1="600" y1="220" x2="670" y2="360" class="connection"/>
  <line x1="600" y1="220" x2="710" y2="360" class="connection"/>

  <!-- Client node -->
  <circle cx="400" cy="60" r="20" class="client"/>
  <text x="400" y="65" class="node-text">Client</text>

  <!-- Tier 1 hosts -->
  <circle cx="200" cy="200" r="15" class="host-tier1"/>
  <text x="200" y="205" class="node-text">H1</text>

  <circle cx="350" cy="200" r="15" class="host-tier1"/>
  <text x="350" y="205" class="node-text">H2</text>

  <circle cx="450" cy="200" r="15" class="host-tier1"/>
  <text x="450" y="205" class="node-text">H3</text>

  <circle cx="600" cy="200" r="15" class="host-tier1"/>
  <text x="600" y="205" class="node-text">H4</text>

  <!-- Tier 2 hosts -->
  <!-- H1's children -->
  <circle cx="80" cy="340" r="12" class="host-tier2"/>
  <text x="80" y="345" class="node-text">H1.1</text>

  <circle cx="140" cy="340" r="12" class="host-tier2"/>
  <text x="140" y="345" class="node-text">H1.2</text>

  <circle cx="200" cy="340" r="12" class="host-tier2"/>
  <text x="200" y="345" class="node-text">H1.3</text>

  <circle cx="260" cy="340" r="12" class="host-tier2"/>
  <text x="260" y="345" class="node-text">H1.4</text>

  <!-- H2's children -->
  <circle cx="290" cy="340" r="12" class="host-tier2"/>
  <text x="290" y="345" class="node-text">H2.1</text>

  <circle cx="330" cy="340" r="12" class="host-tier2"/>
  <text x="330" y="345" class="node-text">H2.2</text>

  <circle cx="370" cy="340" r="12" class="host-tier2"/>
  <text x="370" y="345" class="node-text">H2.3</text>

  <circle cx="410" cy="340" r="12" class="host-tier2"/>
  <text x="410" y="345" class="node-text">H2.4</text>

  <!-- H3's children -->
  <circle cx="440" cy="340" r="12" class="host-tier2"/>
  <text x="440" y="345" class="node-text">H3.1</text>

  <circle cx="480" cy="340" r="12" class="host-tier2"/>
  <text x="480" y="345" class="node-text">H3.2</text>

  <circle cx="520" cy="340" r="12" class="host-tier2"/>
  <text x="520" y="345" class="node-text">H3.3</text>

  <circle cx="560" cy="340" r="12" class="host-tier2"/>
  <text x="560" y="345" class="node-text">H3.4</text>

  <!-- H4's children -->
  <circle cx="590" cy="340" r="12" class="host-tier2"/>
  <text x="590" y="345" class="node-text">H4.1</text>

  <circle cx="630" cy="340" r="12" class="host-tier2"/>
  <text x="630" y="345" class="node-text">H4.2</text>

  <circle cx="670" cy="340" r="12" class="host-tier2"/>
  <text x="670" y="345" class="node-text">H4.3</text>

  <circle cx="710" cy="340" r="12" class="host-tier2"/>
  <text x="710" y="345" class="node-text">H4.4</text>

  <!-- Animated messages from client to tier 1 -->
  <circle r="4" class="message">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0s">
      <mpath href="#path-client-h1"/>
    </animateMotion>
  </circle>

  <circle r="4" class="message">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.3s">
      <mpath href="#path-client-h2"/>
    </animateMotion>
  </circle>

  <circle r="4" class="message">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.6s">
      <mpath href="#path-client-h3"/>
    </animateMotion>
  </circle>

  <circle r="4" class="message">
    <animateMotion dur="1.5s" repeatCount="indefinite" begin="0.9s">
      <mpath href="#path-client-h4"/>
    </animateMotion>
  </circle>

  <!-- Animated messages from tier 1 to tier 2 -->
  <!-- From H1 -->
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="1.5s">
      <mpath href="#path-h1-h11"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="1.7s">
      <mpath href="#path-h1-h12"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="1.9s">
      <mpath href="#path-h1-h13"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.1s">
      <mpath href="#path-h1-h14"/>
    </animateMotion>
  </circle>

  <!-- From H2 -->
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="1.8s">
      <mpath href="#path-h2-h21"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.0s">
      <mpath href="#path-h2-h22"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.2s">
      <mpath href="#path-h2-h23"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.4s">
      <mpath href="#path-h2-h24"/>
    </animateMotion>
  </circle>

  <!-- From H3 -->
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.1s">
      <mpath href="#path-h3-h31"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.3s">
      <mpath href="#path-h3-h32"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.5s">
      <mpath href="#path-h3-h33"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.7s">
      <mpath href="#path-h3-h34"/>
    </animateMotion>
  </circle>

  <!-- From H4 -->
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.4s">
      <mpath href="#path-h4-h41"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.6s">
      <mpath href="#path-h4-h42"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="2.8s">
      <mpath href="#path-h4-h43"/>
    </animateMotion>
  </circle>
  <circle r="3" class="message">
    <animateMotion dur="1.2s" repeatCount="indefinite" begin="3.0s">
      <mpath href="#path-h4-h44"/>
    </animateMotion>
  </circle>

  <!-- Hidden paths for animation -->
  <defs>
    <!-- Client to tier 1 paths -->
    <path id="path-client-h1" d="M 400,80 L 200,200" stroke="none" fill="none"/>
    <path id="path-client-h2" d="M 400,80 L 350,200" stroke="none" fill="none"/>
    <path id="path-client-h3" d="M 400,80 L 450,200" stroke="none" fill="none"/>
    <path id="path-client-h4" d="M 400,80 L 600,200" stroke="none" fill="none"/>

    <!-- H1 to its children -->
    <path id="path-h1-h11" d="M 200,220 L 80,340" stroke="none" fill="none"/>
    <path id="path-h1-h12" d="M 200,220 L 140,340" stroke="none" fill="none"/>
    <path id="path-h1-h13" d="M 200,220 L 200,340" stroke="none" fill="none"/>
    <path id="path-h1-h14" d="M 200,220 L 260,340" stroke="none" fill="none"/>

    <!-- H2 to its children -->
    <path id="path-h2-h21" d="M 350,220 L 290,340" stroke="none" fill="none"/>
    <path id="path-h2-h22" d="M 350,220 L 330,340" stroke="none" fill="none"/>
    <path id="path-h2-h23" d="M 350,220 L 370,340" stroke="none" fill="none"/>
    <path id="path-h2-h24" d="M 350,220 L 410,340" stroke="none" fill="none"/>

    <!-- H3 to its children -->
    <path id="path-h3-h31" d="M 450,220 L 440,340" stroke="none" fill="none"/>
    <path id="path-h3-h32" d="M 450,220 L 480,340" stroke="none" fill="none"/>
    <path id="path-h3-h33" d="M 450,220 L 520,340" stroke="none" fill="none"/>
    <path id="path-h3-h34" d="M 450,220 L 560,340" stroke="none" fill="none"/>

    <!-- H4 to its children -->
    <path id="path-h4-h41" d="M 600,220 L 590,340" stroke="none" fill="none"/>
    <path id="path-h4-h42" d="M 600,220 L 630,340" stroke="none" fill="none"/>
    <path id="path-h4-h43" d="M 600,220 L 670,340" stroke="none" fill="none"/>
    <path id="path-h4-h44" d="M 600,220 L 710,340" stroke="none" fill="none"/>
  </defs>

  <!-- Legend -->
  <text x="50" y="520" class="node-text" style="fill: #333; font-size: 12px; text-anchor: start;">Legend:</text>

  <circle cx="70" cy="540" r="8" class="client"/>
  <text x="85" y="545" class="node-text" style="fill: #333; font-size: 11px; text-anchor: start;">Client</text>

  <circle cx="140" cy="540" r="8" class="host-tier1"/>
  <text x="155" y="545" class="node-text" style="fill: #333; font-size: 11px; text-anchor: start;">Tier 1 Hosts</text>

  <circle cx="240" cy="540" r="8" class="host-tier2"/>
  <text x="255" y="545" class="node-text" style="fill: #333; font-size: 11px; text-anchor: start;">Tier 2 Hosts</text>

  <circle cx="350" cy="540" r="4" class="message"/>
  <text x="365" y="545" class="node-text" style="fill: #333; font-size: 11px; text-anchor: start;">Messages</text>

  <!-- Status indicator -->
  <text x="50" y="480" class="node-text" style="fill: #333; font-size: 12px; text-anchor: start;">Total hosts reached: 20 (1 + 4 + 16)</text>
  <text x="50" y="500" class="node-text" style="fill: #333; font-size: 12px; text-anchor: start;">Fan-out factor: 4x per tier</text>
</svg>
